<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>stylus.rb</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source" href="generators/stylus/install_generator.html">install_generator.rb</a>
          <a class="source" href="stylus.html">stylus.rb</a>
          <a class="source" href="stylus/railtie.html">railtie.rb</a>
          <a class="source" href="stylus/tilt.html">tilt.rb</a>
          <a class="source" href="stylus/version.html">version.rb</a>
      </div>
    </div>
  </div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>stylus.rb</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-Stylus'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Stylus">&#182;</a>
        </div>
        <h1>Stylus</h1>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Usage'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Usage">&#182;</a>
        </div>
        <p><code>stylus</code> is a bridge between your Ruby code and the <a href="https://github.com/LearnBoost/stylus">Stylus</a>
library that runs on Node.js. It&rsquo;s aims to be a replacement for the
<a href="https://github.com/lucasmazza/stylus_rails">stylus_rails</a> gem and to support the Rails 3.1 asset pipeline
(via <a href="https://github.com/rtomayko/tilt">Tilt</a>) and other scenarios,
backed by the <a href="https://github.com/sstephenson/execjs">ExecJS</a> gem.module Stylus</p>

<h2>Usage</h2>

<p>To compile a <code>.styl</code> file or an arbitrary String to .CSS using stylus, just use the <code>compile</code> method.</p>

<p><code>Stylus.compile(File.new(&lsquo;application.styl&rsquo;))</code></p>

<p>A hash of options for the stylus API is accepted.</p>

<p><code>Stylus.compile(File.read(&lsquo;application.styl&rsquo;), :compress =&gt; true)</code></p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">require</span> <span class="s1">&#39;execjs&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;stylus/version&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;stylus/railtie&#39;</span> <span class="k">if</span> <span class="n">defined?</span><span class="p">(</span><span class="o">::</span><span class="no">Rails</span><span class="p">)</span>
<span class="k">module</span> <span class="nn">Stylus</span>
  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="vc">@@compress</span> <span class="o">=</span> <span class="kp">false</span>
    <span class="vc">@@paths</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="vc">@@plugins</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-3">&#182;</a>
        </div>
        <p>Stores a list of plugins to import inside <code>Stylus</code>, with an optional hash.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">use</span><span class="p">(</span><span class="o">*</span><span class="n">options</span><span class="p">)</span>
      <span class="n">arguments</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span> <span class="p">?</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span> <span class="p">:</span> <span class="p">{}</span>
      <span class="n">options</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">plugin</span><span class="o">|</span>
        <span class="vc">@@plugins</span><span class="o">[</span><span class="n">plugin</span><span class="o">]</span> <span class="o">=</span> <span class="n">arguments</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">alias</span> <span class="ss">:plugin</span> <span class="ss">:use</span></pre></div>
      </td>
    </tr>
    <tr id='section-4'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-4">&#182;</a>
        </div>
        <p>Retrieves the plugins registered by <code>use</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">plugins</span>
      <span class="vc">@@plugins</span>
    <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-5">&#182;</a>
        </div>
        <p>Returns the global load path <code>Array</code> for your stylesheets.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">paths</span>
      <span class="vc">@@paths</span>
    <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <p>Replaces the global load path <code>Array</code> of paths.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">paths</span><span class="o">=</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
      <span class="vc">@@paths</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <p>Returns the global compress flag.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">compress</span>
      <span class="vc">@@compress</span>
    <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-8">&#182;</a>
        </div>
        <p>Sets the global flag for the <code>compress</code> option.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">compress</span><span class="o">=</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
      <span class="vc">@@compress</span> <span class="o">=</span> <span class="n">val</span>
    <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-9">&#182;</a>
        </div>
        <p>Compiles a given input &ndash; a <code>File</code>, <code>StringIO</code>, <code>String</code> or anything that responds to <code>read</code>.
Also accepts a hash of options that will be merged with the global configuration.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
      <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">read</span> <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">respond_to?</span><span class="p">(</span><span class="ss">:read</span><span class="p">)</span>
      <span class="n">options</span> <span class="o">=</span> <span class="n">merge_options</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
      <span class="n">context</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">plugins</span><span class="p">)</span>
    <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-10">&#182;</a>
        </div>
        <p>Converts back an input of plain CSS to the <code>Stylus</code> syntax. The source object can be
 a <code>File</code>, <code>StringIO</code>, <code>String</code> or anything that responds to <code>read</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
      <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">read</span> <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">respond_to?</span><span class="p">(</span><span class="ss">:read</span><span class="p">)</span>
      <span class="n">context</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;convert&#39;</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-11">&#182;</a>
        </div>
        <p>Returns a <code>Hash</code> of the given <code>options</code> merged with the default configuration.
It also concats the global load path with a given <code>Array</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">merge_options</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
      <span class="n">_paths</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="ss">:paths</span><span class="p">)</span>
      <span class="n">options</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
      <span class="n">options</span><span class="o">[</span><span class="ss">:paths</span><span class="o">]</span> <span class="o">=</span> <span class="n">paths</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="nb">Array</span><span class="p">(</span><span class="n">_paths</span><span class="p">))</span>
      <span class="n">options</span>
    <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-12">&#182;</a>
        </div>
        <p>Returns the default <code>Hash</code> of options.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">defaults</span>
      <span class="p">{</span> <span class="ss">:compress</span> <span class="o">=&gt;</span> <span class="nb">self</span><span class="o">.</span><span class="n">compress</span><span class="p">,</span> <span class="ss">:paths</span> <span class="o">=&gt;</span> <span class="nb">self</span><span class="o">.</span><span class="n">paths</span> <span class="p">}</span>
    <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-13">&#182;</a>
        </div>
        <p>Return the gem version alongside with the current <code>Stylus</code> version of your system.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">version</span>
      <span class="s2">&quot;Stylus - gem </span><span class="si">#{</span><span class="no">VERSION</span><span class="si">}</span><span class="s2"> library </span><span class="si">#{</span><span class="n">context</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">end</span>

    <span class="kp">protected</span></pre></div>
      </td>
    </tr>
    <tr id='section-14'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-14">&#182;</a>
        </div>
        <p>Returns the <code>ExecJS</code> execution context.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">context</span>
      <span class="vc">@@_context</span> <span class="o">||=</span> <span class="n">backend</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
    <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-15">&#182;</a>
        </div>
        <p>Reads the default compiler script that <code>ExecJS</code> will execute.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">script</span>
      <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../stylus/compiler.js&#39;</span><span class="p">,</span><span class="bp">__FILE__</span><span class="p">))</span>
    <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-16'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-16">&#182;</a>
        </div>
        <p>We&rsquo;re targeting the Runtime directly so we don&rsquo;t mess with other
gems using <code>ExecJS</code>.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">backend</span>
      <span class="vc">@@_backend</span> <span class="o">||=</span> <span class="no">ExecJS</span><span class="o">::</span><span class="no">Runtimes</span><span class="o">::</span><span class="no">Node</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
